--- origsrc/less-382/LICENSE	2009-12-31 10:40:10.775125000 +0900
+++ src/less-382/LICENSE	2009-12-31 10:40:32.197000000 +0900
@@ -7,6 +7,12 @@ Copyright (C) 1984-2002  Mark Nudelman
 Japanized part of Less
 Copyright (c) 1994-2005  Kazushi (Jam) Marukawa
 
+Patch for cp932
+Copyright (C) 2000-2001 Yosuke IMADA
+
+Adjustment of the patch for cp932 to less-382-iso262
+Copyright (c) 2007 Yak!
+
 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions
 are met:
--- origsrc/less-382/defines.h.in	2009-12-31 10:40:20.400125000 +0900
+++ src/less-382/defines.h.in	2009-12-31 10:40:32.212625000 +0900
@@ -451,3 +451,7 @@
 
 /* Define to `unsigned' if <sys/types.h> does not define. */
 #undef size_t
+
+/* Define if you have a font for tty which have NEC-tokushu-moji,
+   IBM-sentei-NEC-kakuchou-moji IBM-sentei-NEC-kakuchou-moji */
+#define HAVE_NECEXTFNT 1
--- origsrc/less-382/defines.wn	2009-12-31 10:40:12.587625000 +0900
+++ src/less-382/defines.wn	2009-12-31 10:40:32.243875000 +0900
@@ -385,5 +385,9 @@
 #define HAVE_VALUES_H 1
 #endif
 
+/* Define if you have a font for tty which have NEC-tokushu-moji,
+   IBM-sentei-NEC-kakuchou-moji IBM-sentei-NEC-kakuchou-moji */
+#define HAVE_NECEXTFNT 1
+
 #define	popen	_popen
 #define	pclose	_pclose
--- origsrc/less-382/multi.c	2009-12-31 10:40:24.525125000 +0900
+++ src/less-382/multi.c	2009-12-31 10:40:32.306375000 +0900
@@ -597,6 +597,39 @@ MULBUF *mp;
     return 0;
 }
 
+#if HAVE_NECEXTFNT
+/*
+ * Convert IBM-sentei-IBM-kakuchou-moji to NEC-sentei-IBM-kakuchou-moji
+ */
+static int IbmtoNec(int sjis){
+	    if(0xFA40 <= sjis & sjis <= 0xFA7E){
+		     if(sjis <= 0xFA49)	{sjis -= 0x0B51;}
+		else if(sjis <= 0xFA53)	{sjis -= 0x72F6;}
+		else if(sjis <= 0xFA57)	{sjis -= 0x0B5B;}
+		else if(sjis == 0xFA58)	{sjis  = 0x878A;}
+		else if(sjis == 0xFA59)	{sjis  = 0x8782;}
+		else if(sjis == 0xFA5A)	{sjis  = 0x8784;}
+		else if(sjis == 0xFA5B)	{sjis  = 0x81E6;}
+		else			{sjis -= 0x0D1C;}
+	}else if(0xFA80 <= sjis & sjis <= 0xFA9B){
+					 sjis -= 0x0D1D;
+	}else if(0xFA9C <= sjis & sjis <= 0xFAFC){
+					 sjis -= 0x0D1C;
+	}else if(0xFB40 <= sjis & sjis <= 0xFB5B){
+					 sjis -= 0x0D5F;
+	}else if(0xFB5C <= sjis & sjis <= 0xFB7E){
+					 sjis -= 0x0D1C;
+	}else if(0xFB80 <= sjis & sjis <= 0xFB9B){
+					 sjis -= 0x0D1D;
+	}else if(0xFB9C <= sjis & sjis <= 0xFBFC){
+					 sjis -= 0x0D1C;
+	}else if(0xFC40 <= sjis & sjis <= 0xFC4B){
+					 sjis -= 0x0D5F;
+	}
+	return sjis;
+}
+#endif
+
 /*
  * Internalize input stream encoded by SJIS encoding scheme.
  *
@@ -624,6 +657,14 @@ MULBUF *mp;
 	int c0 = INBUF0(mp);
 	int c1 = INBUF1(mp);
 	if (ISSJISKANJI(c0, c1)) {
+#if HAVE_NECEXTFNT
+            int sjis;
+            sjis = (c0 << 8) & 0xFF00 |
+                    c1       & 0x00FF;
+            sjis = IbmtoNec(sjis);
+            c0 = (sjis >> 8) & 0xFF;
+            c1 =  sjis       & 0xFF;
+#endif
 	    if (mp->io.scs & SCSJISX0213_2004) {
 		mp->icharset = SJIS2004;
 		mp->cs = JISX02132004KANJI1;
--- origsrc/less-382/unify.c	2009-12-31 10:40:20.790750000 +0900
+++ src/less-382/unify.c	2009-12-31 10:40:32.603250000 +0900
@@ -751,10 +751,29 @@ static convtable utable_n_iso646 = { uni
 
 static convtab eliminate_wrong_jisx0208_78[] = {
 	/* empty rows */
+#if HAVE_NECEXTFNT
+	/* 8 KU 0x2841()-0x287E() -> 0x222E(〓) */
+	{"(A", "(~", "\".", JISX0208KANJI },
+	/* 9-12 KU 0x2921()-0x2C7E() -> 0x222E(〓) */
+	{")!", ",~", "\".", JISX0208KANJI },
+	/* 13 KU 0x2D3F,0x2D57-0x2D5E,0x2D7D-0x2D7E -> 0x222E(〓) */
+	{ "-?", "-?", "\".", JISX0208KANJI },
+	{ "-W", "-^", "\".", JISX0208KANJI },
+	{ "-}", "-~", "\".", JISX0208KANJI },
+	/* 14-15 KU 0x2E21()-0x2F7E() -> 0x222E(〓) */
+	{ ".!", "/~", "\".", JISX0208KANJI },
+	/* 84-88 KU 0x7427()-0x787E() -> 0x222E(〓) */
+	{ "t'", "x~", "\".", JISX0208KANJI },
+	/* 92 KU 0x7C6F()-0x7C70() -> 0x222E(〓) */
+	{ "|o", "|p", "\".", JISX0208KANJI },
+	/* 93-94 KU 0x7D21()-0x7E7E() -> 0x222E(〓) */
+	{ "}!", "~~", "\".", JISX0208KANJI },
+#else
 	/* 8-15 KU 0x2821(─)-0x2F7E() -> 0x222E(〓) */
 	{ "(!", "/~", "\".", JISX0208KANJI },
 	/* 84-94 KU 0x7421(堯)-0x7E7E() -> 0x222E(〓) */
 	{ "t!", "~~", "\".", JISX0208KANJI },
+#endif /*HAVE_NECEXTFNT*/
 
 	/* sequences of empty columns */
 	/* 2 KU 0x222F()-0x227E(◯) -> 0x222E(〓) */
@@ -789,10 +808,27 @@ static convtable etable_jisx0208_78 = { 
 
 static convtab eliminate_wrong_jisx0208_83[] = {
 	/* empty rows */
+#if HAVE_NECEXTFNT
+	/* 9-12 KU 0x2921()-0x2C7E() -> 0x222E(〓) */
+	{")!", ",~", "\".", JISX0208KANJI },
+	/* 13 KU 0x2D3F,0x2D57-0x2D5E,0x2D7D-0x2D7E -> 0x222E(〓) */
+	{ "-?", "-?", "\".", JISX0208KANJI },
+	{ "-W", "-^", "\".", JISX0208KANJI },
+	{ "-}", "-~", "\".", JISX0208KANJI },
+	/* 14-15 KU 0x2E21()-0x2F7E() -> 0x222E(〓) */
+	{ ".!", "/~", "\".", JISX0208KANJI },
+	/* 84-88 KU 0x7427()-0x787E() -> 0x222E(〓) */
+	{ "t'", "x~", "\".", JISX0208KANJI },
+	/* 92 KU 0x7C6F()-0x7C70() -> 0x222E(〓) */
+	{ "|o", "|p", "\".", JISX0208KANJI },
+	/* 93-94 KU 0x7D21()-0x7E7E() -> 0x222E(〓) */
+	{ "}!", "~~", "\".", JISX0208KANJI },
+#else
 	/* 9-15 KU 0x2921()-0x2F7E() -> 0x222E(〓) */
 	{ ")!", "/~", "\".", JISX0208KANJI },
 	/* 85-94 KU 0x7521()-0x7E7E() -> 0x222E(〓) */
 	{ "u!", "~~", "\".", JISX0208KANJI },
+#endif /*HAVE_NECEXTFNT
 
 	/* sequences of empty columns */
 	/* 2 KU 0x222F()-0x2239() -> 0x222E(〓) */
@@ -839,10 +875,27 @@ static convtable etable_jisx0208_83 = { 
 
 static convtab eliminate_wrong_jisx0208_90[] = {
 	/* empty rows */
+#if HAVE_NECEXTFNT
+	/* 9-12 KU 0x2921()-0x2C7E() -> 0x222E(〓) */
+	{")!", ",~", "\".", JISX0208KANJI },
+	/* 13 KU 0x2D3F,0x2D57-0x2D5E,0x2D7D-0x2D7E -> 0x222E(〓) */
+	{ "-?", "-?", "\".", JISX0208KANJI },
+	{ "-W", "-^", "\".", JISX0208KANJI },
+	{ "-}", "-~", "\".", JISX0208KANJI },
+	/* 14-15 KU 0x2E21()-0x2F7E() -> 0x222E(〓) */
+	{ ".!", "/~", "\".", JISX0208KANJI },
+	/* 84-88 KU 0x7427()-0x787E() -> 0x222E(〓) */
+	{ "t'", "x~", "\".", JISX0208KANJI },
+	/* 92 KU 0x7C6F()-0x7C70() -> 0x222E(〓) */
+	{ "|o", "|p", "\".", JISX0208KANJI },
+	/* 93-94 KU 0x7D21()-0x7E7E() -> 0x222E(〓) */
+	{ "}!", "~~", "\".", JISX0208KANJI },
+#else
 	/* 9-15 KU 0x2921()-0x2F7E() -> 0x222E(〓) */
 	{ ")!", "/~", "\".", JISX0208KANJI },
 	/* 85-94 KU 0x7521()-0x7E7E() -> 0x222E(〓) */
 	{ "u!", "~~", "\".", JISX0208KANJI },
+#endif /*HAVE_NECEXTFNT
 
 	/* sequences of empty columns */
 	/* 2 KU 0x222F()-0x2239() -> 0x222E(〓) */
@@ -1076,8 +1129,19 @@ static convtab eliminate_wrong_sjis[] = 
 	{ "\204\222", "\204\236", "\201\254", SJIS },
 	/* 8 KU 0x84BF()-0x84FC() -> 0x81AC(〓) */
 	{ "\204\277", "\204\374", "\201\254", SJIS },
+#if HAVE_NECEXTFNT
+	/* 9-12 KU 0x8540()-0x86FC(&@) -> 0x81AC(〓) */
+	{ "\205\100", "\206\374", "\201\254", SJIS },
+	/* 13-KU 0x875E,0x8776-0x877D,0x877F -> 0x81AC(〓) */
+	{ "\207\136", "\207\136", "\201\254", SJIS },
+	{ "\207\166", "\207\175", "\201\254", SJIS },
+	{ "\207\177", "\207\177", "\201\254", SJIS },
+	/* 14-KU 0x879D()-0x87FC() -> 0x81AC(〓) */
+	{ "\207\235", "\207\374", "\201\254", SJIS },
+#else
 	/* 9-14 KU 0x8540()-0x87FC() -> 0x81AC(〓) */
 	{ "\205\100", "\207\374", "\201\254", SJIS },
+#endif
 	/* 15 KU 0x8840()-0x889E() -> 0x81AC(〓) */
 	{ "\210\100", "\210\236", "\201\254", SJIS },
 	/* 47 KU 0x9873()-0x989E() -> 0x81AC(〓) */
@@ -1089,8 +1153,17 @@ static convtab eliminate_wrong_sjis[] = 
 	 * SJIS uses area from 85 KU to 120 KU for GAIJI, but current less
 	 * doesn't allow GAIJI.
 	 */
+#if HAVE_NECEXTFNT
+	/* 85-88 KU 0xEB40()-0xEB9E() -> 0x81AC(〓) */
+	{ "\353\100", "\354\374", "\201\254", SJIS },
+	/* 92 KU 0xEEED()-0xEEEE(荏竪〓) */
+	{ "\356\355", "\356\356", "\201\254", SJIS },
+	/* 93-94 KU 0xEF40()-0xEFFC() -> 0x81AC(〓) */
+	{ "\357\100", "\357\374", "\201\254", SJIS },
+#else
 	/* 85-94 KU 0xEB40()-0xEFFC() -> 0x81AC(〓) */
 	{ "\353\100", "\357\374", "\201\254", SJIS },
+#endif
 	/* 95-120 KU 0xF040(none)-0xFC9E(none) -> 0x81AC(〓) */
 	{ "\360\100", "\374\374", "\201\254", SJIS },
 
@@ -1189,14 +1262,34 @@ static convtab eliminate_wrong_ujis[] = 
 	/* UJIS uses JIS X 0208 1983 */
 
 	/* empty rows */
+#if HAVE_NECEXTFNT
+	/* 9-12 KU 0xA9A1()-0xACFE() -> 0xA2AE(〓) */
+	{ "\251\241", "\254\376", "\242\256", UJIS },
+	/* 13-KU 0xADBF,0xADD7-0xADDE,0xADFD-0xADFE -> 0xA2AE(〓) */
+	{ "\255\277", "\255\277", "\242\256", UJIS },
+	{ "\255\327", "\255\336", "\242\256", UJIS },
+	{ "\255\375", "\255\376", "\242\256", UJIS },
+	/* 14-15 KU 0xAEA1()-0xAFFE() -> 0xA2AE(〓) */
+	{ "\256\241", "\257\376", "\242\256", UJIS },
+#else
 	/* 9-15 KU 0xA9A1()-0xAFFE() -> 0xA2AE(〓) */
 	{ "\251\241", "\257\376", "\242\256", UJIS },
+#endif
 	/*
 	 * UJIS uses area from 85 KU to 94 KU for GAIJI, but current less
 	 * doesn't allow GAIJI.
 	 */
+#if HAVE_NECEXTFNT
+	/* 85-88 KU 0xF5A1()-0xF8FE() -> 0x81AC(〓) */
+	{ "\365\241", "\370\376", "\242\256", UJIS },
+	/* 92 KU 0xFCEF()-0xFCF0  () -> 0x81AC(〓) */
+	{ "\374\357", "\374\360", "\242\256", UJIS },
+	/* 93-94 KU 0xFDA1()-0xFEFE() -> 0x81AC(〓) */
+	{ "\375\100", "\376\374", "\242\256", UJIS },
+#else
 	/* 85-94 KU 0xF5A1()-0xFEFE() -> 0xA2AE(〓) */
 	{ "\365\241", "\376\376", "\242\256", UJIS },
+#endif
 
 	/* sequences of empty columns */
 	/* 2 KU 0xA2AF()-0xA2B9() -> 0xA2AE(〓) */
--- origsrc/less-382/version.c	2009-12-31 10:40:24.603250000 +0900
+++ src/less-382/version.c	2009-12-31 10:40:33.040750000 +0900
@@ -768,4 +768,4 @@ iso262 2/24/06	Removed POSITION variable
 		This modification make regex_cs-lwp9k be able to compile.
 */
 
-char version[] = "382+iso262";
+char version[] = "382+iso262-imd1";
